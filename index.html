<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Socket.IO chat</title>
    <style>
      body { background: #5ab95a; color: white; margin: 0; padding-bottom: 3rem; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

      form {
        display: grid;
        height: 100vh;
        grid-auto-rows: 3rem;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        align-items: center;
      }
      form div {
        display: flex;
      }
      input {
        margin: 0.2rem;
        padding: 0.8rem;
        border-radius: 4px;
        border: 1px #666 solid;
        flex: 1;
      }
      button {
        padding: 0.4rem;
        border-radius: 4px;
        border:none;
        font-size: 1.5rem;
      }
      form div {
        display: flex;
        align-items: center;
      }

      .hide {
        display: none;
      }
    </style>
  </head>
  <body>

    <div id="joinForm">
      <input id="nameInput" autocomplete="off" placeholder="name" /><button id="submitName">GO</button>
    </div>

    <div id="quizForms" class="hide">
      <form id="form1" action="">
        <div>1<input data-q id="q1" placeholder="Q1" autocomplete="off" /></div>
        <div>2<input data-q id="q2" placeholder="Q2" autocomplete="off" /></div>
        <div>3<input data-q id="q3" placeholder="Q3" autocomplete="off" /></div>
        <div>4<input data-q id="q4" placeholder="Q4" autocomplete="off" /></div>
        <div>5<input data-q id="q5" placeholder="Q5" autocomplete="off" /></div>
        <button>Send</button>
      </form>
  
      <form id="form2" action="">
        <div>6<input data-q id="q6" placeholder="Q6" autocomplete="off" /></div>
        <div>7<input data-q id="q7" placeholder="Q7" autocomplete="off" /></div>
        <div>8<input data-q id="q8" placeholder="Q8" autocomplete="off" /></div>
        <button>Send</button>
      </form>

      <form id="form3" action="">
        <div>9<input data-q id="q9" placeholder="Q9" autocomplete="off" /></div>
        <div>10<input data-q id="q10" placeholder="Q10" autocomplete="off" /></div>
        <div>11<input data-q id="q11" placeholder="Q11" autocomplete="off" /></div>
        <button>Send</button>
      </form>

      <form id="form4" action="">
        <div>12<input data-q id="q12" placeholder="Q12" autocomplete="off" /></div>
        <div>13<input data-q id="q13" placeholder="Q13" autocomplete="off" /></div>
        <div>14<input data-q id="q14" placeholder="Q14" autocomplete="off" /></div>
        <button>Send</button>
      </form>

      <form id="form5" action="">
        <div>15<input data-q id="q15" placeholder="Q15" autocomplete="off" /></div>
        <div>16<input data-q id="q16" placeholder="Q16" autocomplete="off" /></div>
        <div>17<input data-q id="q17" placeholder="Q17" autocomplete="off" /></div>
        <button>Send</button>
      </form>

      <form id="form6" action="">
        <div>18<input data-q id="q18" placeholder="Q18" autocomplete="off" /></div>
        <div>19<input data-q id="q19" placeholder="Q19" autocomplete="off" /></div>
        <div>20<input data-q id="q20" placeholder="Q20" autocomplete="off" /></div>
        <button>Send</button>
      </form>

      <form id="form7" action="">
        <div>21<input data-q id="q21" placeholder="Q21" autocomplete="off" /></div>
        <div>22<input data-q id="q22" placeholder="Q22" autocomplete="off" /></div>
        <div>23<input data-q id="q23" placeholder="Q23" autocomplete="off" /></div>
        <button>Send</button>
      </form>

      <form id="form7" action="">
        <div>24<input data-q id="q24" placeholder="Q24" autocomplete="off" /></div>
        <div>25<input data-q id="q25" placeholder="Q25" autocomplete="off" /></div>
        <button>Send</button>
      </form>

      <div id="form8" style="height: 100vh;">
      <h2 style="padding: 2rem;">Thanks for playing!</h2>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
      const login = () => {
        document.querySelector('#joinForm').classList.add('hide');
        document.querySelector('#quizForms').classList.remove('hide');
      }

      let sessionId;
      const socket = io();
      const submitName = document.getElementById('submitName');
      submitName.addEventListener('click', (e) => {
        e.preventDefault();
        console.log(document.querySelector('#nameInput').value);
        socket.emit('usr', {id: sessionId, name: document.querySelector('#nameInput').value});
        window.sessionStorage.setItem(`user`, sessionId);
        login();
      });

      socket.on('connect', () => {
          sessionId = socket.id;
          const savedId = window.sessionStorage.getItem(`user`);
          if(savedId){
            sessionId = savedId;
            login();
          };
          console.log(sessionId);
      })


      document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          const answers = [...document.querySelectorAll('[data-q]')].map(a => ({q: parseInt(a.id.substring(1)), a: a.value}));
          console.log(answers);
          socket.emit('answers', {id: sessionId, answers});
          console.log(e.target.id[4]);
          const nextForm = parseInt(e.target.id[4])+1;
          window.location.href = "#form"+nextForm;
        });
      });

      document.querySelectorAll('[data-q]').forEach(inpt => {
        inpt.addEventListener('keyup', () => {
          console.log('keyup!');
          const inps = [...document.querySelectorAll('[data-q]')].map(i => i.value);
          window.sessionStorage.setItem(`answers`, JSON.stringify(inps));
        })
      });
      
      const savedAs = window.sessionStorage.getItem(`answers`);
      if(savedAs){
        const answrs = JSON.parse(savedAs);
        document.querySelectorAll('[data-q]').forEach((inpt, i) => {
          console.log(inpt, answrs[i]);
          inpt.value = answrs[i];
        })
      }

      socket.on('hello', (msg) => {
        console.log('received evt');
      });
    </script>
  </body>
</html>